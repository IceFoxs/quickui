<!DOCTYPE html>

<html>
<head>
<title>QuickUI Rehydrate Unit Tests</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link rel="stylesheet" type="text/css" href="http://code.jquery.com/qunit/git/qunit.css" />
<link rel="stylesheet" type="text/css" href="http://quickui/plugins/quickui.rehydrate.css" />
<link rel="stylesheet" type="text/css" href="http://quickui/release/quickui.catalog.css" />

<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
<script type="text/javascript" src="http://quickui/release/quickui.js"></script>
<script type="text/javascript" src="http://quickui/plugins/quickui.rehydrate.js"></script>
<script type="text/javascript" src="http://quickui/release/quickui.catalog.js"></script>

<script>
/*
 * QUnit tests
 */
function runTests() {
    
    test( "Control with content", function() {
        var $e = $( "#testControl" );
        var $c = Control( $e ).rehydrate();
        // Since original element was a div, and control's desired tag is a div,
        // the control should use the original element.
        equal( $c[0], $e[0] );
        ok( $c instanceof Control );
        ok( $e.control() instanceof Control );
        equal( $c.content(), "Hello" );
    });
    
    // Try changing a div to a button.
    test( "Replace element", function() {
        var $e = $( "#testReplaceElement" );
        var $c = Control( $e ).rehydrate();
        // Since $e was a div, and $c is now a button, they should differ.
        ok( $e[0] !== $c[0] );
        equal( $c.content(), "OK" );
        equal( $c[0].nodeName.toLowerCase(), "button" );
    });
    
    test( "Property attribute", function() {
        var $c = Control( "#testPropertyAttribute" ).rehydrate();
        ok( $c.disabled() );
    });
    
    test( "Compound property", function() {
        var $c = Control( "#testCompoundProperty" ).rehydrate();
        equal( $c.heading().trim(), "Heading" );
        // The content property ends up with an extra white space text node,
        // which we ignore.
        equal( $c.content()[1].trim(), "Content" );
    });
    
    test( "Subcontrol", function() {
        var $c = Control( "#testSubcontrol" ).rehydrate();
        ok( $c instanceof Page );
        // Ignore white space text nodes in content.
        var $subcontrol = $c.content().eq(1).control();
        ok( $subcontrol instanceof BasicButton );
        equal( $subcontrol.content(), "OK" );
    });
    
    test( "Multiple controls at once", function() {
        var $c = Control( "#testMultiple" ).children().rehydrate();
        equal( $c.length, 2 );
        ok( $c instanceof BasicButton );
        equal( $c.eq(0).content(), "OK" );
        equal( $c.eq(1).content(), "Cancel" );
    })
}
    
$( function() {
    runTests();
});
</script>

<style>
#test-cases {
    display: none;
}
</style>

</head>

<body>
    <h1 id="qunit-header">QuickUI Unit Tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
    <div id="test-cases">
        
        <div id="testControl" data-control="Control">Hello</div>
        
        <div id="testReplaceElement" data-control="BasicButton">OK</div>
        
        <div id="testPropertyAttribute" data-control="BasicButton" data-disabled="true">Cancel</div>
                
        <div id="testCompoundProperty" data-control="Collapsible">
            <div data-property="heading">Heading</div>
            Content
        </div>
        
        <div id="testSubcontrol" data-control="Page">
            <div data-control="BasicButton">OK</div>
        </div>
        
        <div id="testMultiple">
            <div data-control="BasicButton">OK</div>
            <div data-control="BasicButton">Cancel</div>
        </div>
        
    </div>
</body>

</html>
